<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CHEMIDREAM TERMINAL</title>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  font-family: monospace;
  overflow: hidden;
}

/* ===== BOOT ===== */
#boot {
  position: fixed;
  inset: 0;
  background: black;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #9cff9c;
  font-size: 56px;
  letter-spacing: 6px;
  text-shadow: 0 0 20px #00ff66;
  animation: bootGlitch 1.2s infinite;
  z-index: 10;
}

@keyframes bootGlitch {
  0% { transform: translate(0,0); }
  25% { transform: translate(-2px,1px); opacity:.7 }
  50% { transform: translate(2px,-1px); }
  75% { transform: translate(-1px,2px); opacity:.85 }
  100% { transform: translate(0,0); }
}

/* ===== MONITOR ===== */
#monitor-wrapper {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
}

#monitor {
  position: relative;
  width: 96vw;
  height: 96vh;
  background: url("assets/monitor.png") center/contain no-repeat;
}

/* ===== CRT SCREEN ===== */
#screen {
  position: absolute;
  top: 13%;
  left: 33%;
  width: 35%;
  height: 54%;
  overflow: hidden;
  border-radius: 24px;

  box-shadow:
    inset 0 0 40px rgba(0,255,120,0.18),
    inset 0 0 120px rgba(0,0,0,0.75);
}

#screen::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      ellipse at center,
      rgba(0,255,120,0.06) 0%,
      rgba(0,0,0,0.15) 55%,
      rgba(0,0,0,0.45) 75%,
      rgba(0,0,0,0.8) 100%
    );
  pointer-events: none;
}

/* ===== TERMINAL ===== */
#terminal {
  position: relative;
  width: 100%;
  height: 100%;
  padding: 14px;
  color: #9cff9c;
  font-size: 16px;
  line-height: 1.45;
  white-space: pre-wrap;
  overflow-y: auto;
  text-shadow: 0 0 6px #00ff66;
}

#history div { margin-bottom: 6px; }

/* ===== INPUT ===== */
#input-line { display: flex; }
#prompt { margin-right: 6px; }
#input { white-space: pre; }

.cursor {
  width: 10px;
  background: #9cff9c;
  animation: blink 1s steps(1) infinite;
}

@keyframes blink { 50% { opacity: 0; } }

/* ===== NOISE ===== */
#noise {
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: repeating-linear-gradient(
    rgba(255,255,255,0.015),
    rgba(255,255,255,0.015) 1px,
    transparent 2px,
    transparent 4px
  );
  animation: flicker .25s infinite;
  display: none;
}

@keyframes flicker {
  0% { opacity:.12 }
  50% { opacity:.22 }
  100% { opacity:.12 }
}
</style>
</head>

<body>

<div id="boot">PRESS ANY KEY</div>

<div id="monitor-wrapper">
  <div id="monitor">
    <div id="screen">
      <div id="terminal">
        <div id="history"></div>
        <div id="input-line">
          <span id="prompt">&gt;</span>
          <span id="input"></span><span class="cursor"></span>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="noise"></div>
<audio id="hum" src="assets/hum.mp3" loop></audio>

<script>
const boot = document.getElementById("boot");
const monitorWrapper = document.getElementById("monitor-wrapper");
const history = document.getElementById("history");
const input = document.getElementById("input");
const hum = document.getElementById("hum");
const noise = document.getElementById("noise");

/* ===== QUEUE ===== */
let queue = [];
let typing = false;

function enqueue(text, speed = 28, color = null) {
  queue.push({ text, speed, color });
  if (!typing) processQueue();
}

function processQueue() {
  if (queue.length === 0) { typing = false; return; }
  typing = true;
  const { text, speed, color } = queue.shift();
  typeLine(text, speed, color, processQueue);
}

function typeLine(text, speed, color, done) {
  let i = 0;
  const line = document.createElement("div");
  if (color) line.style.color = color;
  history.appendChild(line);

  const interval = setInterval(() => {
    if (i < text.length) {
      line.textContent += text[i++];
    } else {
      clearInterval(interval);
      done();
    }
  }, speed);
}

/* ===== START ===== */
let active = false;

function startSystem() {
  if (active) return;
  active = true;

  boot.style.display = "none";
  monitorWrapper.style.display = "flex";
  noise.style.display = "block";

  hum.volume = 0.35;
  hum.play().catch(()=>{});

  [
    "CHEMIDREAM INTERNAL INTERFACE",
    "ACCESS NODE: UNKNOWN",
    "",
    "intrusion detected",
    "initializing consciousness core...",
    "ERROR // unauthorized observer",
    "",
    "SYSTEM ONLINE",
    ""
  ].forEach(l => enqueue(l));
}

/* ===== FILE SYSTEM ===== */
let clearance = "GUEST";
let path = ["core"];

const fs = {
  core: {
    systems: {
      thermal: { type: "file", color: "#ffff88", content: "CORE TEMP: 41.6C\nCOOLING: ACTIVE" },
      neural: { type: "file", color: "#ffffff", content: "NEURAL NOISE DETECTED\nAWARENESS: HIGH" },
      integrity: { type: "file", color: "#ff5555", content: "DATA INTEGRITY: FAILING" }
    },
    memory: {
      fragments: {
        "note_01.txt": { type: "file", content: "I remember my hands" },
        "note_02.txt": { type: "file", content: "Pain has no edges here" }
      },
      restricted: {
        _clearance: "OBSERVER",
        "truth.log": { type: "file", color: "#ff4444", content: "BODY LOST. CORE PRESERVED." }
      }
    },
    surveillance: {
      hallway: {
        "cam_01.mp4": { type: "download", path: "assets/files/cam_01.mp4" }
      }
    },
    applications: {
      status: { type: "app", run: () => {
        enqueue("SUBJECT: ACTIVE", 24, "#ffffff");
        enqueue("BODY: NOT PRESENT", 24, "#ff5555");
        enqueue("STATE: CONTAINED", 24, "#ffff88");
      }}
    }
  }
};

function getDir() {
  let d = fs;
  for (let p of path) d = d[p];
  return d;
}

/* ===== INPUT ===== */
document.addEventListener("keydown", e => {
  if (typing) return;

  if (!active) {
    startSystem();
    return;
  }

  if (e.key === "Backspace") {
    input.textContent = input.textContent.slice(0,-1);
    e.preventDefault();
  } else if (e.key === "Enter") {
    const cmd = input.textContent.trim().toLowerCase();
    enqueue("> " + cmd, 18);
    handleCommand(cmd);
    input.textContent = "";
  } else if (e.key.length === 1) {
    input.textContent += e.key;
  }
});

/* ===== COMMANDS ===== */
function handleCommand(cmd) {
  const parts = cmd.split(" ");
  const dir = getDir();

  if (cmd === "ls") {
    Object.keys(dir).filter(k => !k.startsWith("_")).forEach(k => enqueue(k, 20, "#9cff9c"));
    return;
  }

  if (cmd === "pwd") {
    enqueue("/" + path.join("/"), 20, "#ffffff");
    return;
  }

  if (parts[0] === "cd") {
    const target = parts[1];
    if (!dir[target] || dir[target].type === "file") {
      enqueue("DIRECTORY NOT FOUND", 22, "#ff5555");
      return;
    }
    if (dir[target]._clearance && clearance === "GUEST") {
      enqueue("INSUFFICIENT CLEARANCE", 22, "#ff5555");
      return;
    }
    path.push(target);
    return;
  }

  if (parts[0] === "cat") {
    const f = dir[parts[1]];
    if (!f || f.type !== "file") {
      enqueue("FILE NOT FOUND", 22, "#ff5555");
      return;
    }
    enqueue(f.content, 26, f.color || "#ffffff");
    return;
  }

  if (parts[0] === "open") {
    const f = dir[parts[1]];
    if (f && f.type === "download") {
      const a = document.createElement("a");
      a.href = f.path;
      a.download = "";
      a.click();
      enqueue("DOWNLOAD STARTED", 22, "#ffff88");
      return;
    }
    enqueue("UNSUPPORTED FILE", 22, "#ff5555");
    return;
  }

  if (parts[0] === "run") {
    const app = dir[parts[1]];
    if (app && app.type === "app") {
      app.run();
      return;
    }
    enqueue("APPLICATION NOT FOUND", 22, "#ff5555");
    return;
  }

  enqueue("UNKNOWN COMMAND", 22, "#ff5555");
}

/* ===== VENIAMIN ===== */
const veniaminLines = [
  "I still feel my hands",
  "this is not sleep",
  "they said it would end",
  "pain never initializes",
  "this screen is my skin",
  "this prison has no walls",
  "my body is gone",
  "this is after death",
  "I am awake",
  "this never ends"
];

setInterval(() => {
  if (active && !typing && Math.random() < 0.25) {
    enqueue(veniaminLines[Math.floor(Math.random()*veniaminLines.length)], 32, "#ff6666");
  }
}, 35000);
</script>

</body>
</html>
